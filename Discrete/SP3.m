%RICHARD VASQUES 

clear all
clc

T=10; % Total length of system
n=100; % # of points
m1=1;
m2=2;
m3=6;
m4=24;
m5=120;
m6=720;
c=0.000001;
q=1;




l1=3*m4/(10*m2^2)-m3/(3*m1*m2);
l2=(9*m5/5-27*m1*m6/(21*m2)+3*m3*m4/m2-10*m3^2/(3*m1))/(10*m2*m3-9*m1*m4);
%l2=abs((9*m5/5-27*m1*m6/(21*m2)+3*m3*m4/m2-10*m3^2/(3*m1))/(10*m2*m3-9*m1*m4))
b1=m3/(3*m1*m2)-1;
b2=(10*m3^2/(3*m1)-9*m5/5)/(10*m2*m3-9*m1*m4)-1;


h=T/n;
Et=2*m1/m2;
Ea=((1-c)/m1)/(1+b1*(1-c));
Q=q/(1+b1*(1-c));
E2=4*(1+b1*(1-c))*(1-b2*(1-c))/(5*l1*m1);
%E3=abs(27*l1*Et/(28*l2*(1+b1*(1-c))-l1))
E3=27*l1*Et/(28*l2*(1+b1*(1-c))-l1);
D=1/(3*Et);

A=zeros(2*n+2,2*n+2);
B=zeros(2*n+2,1);
Z=zeros(2*n+2,1);
SF=zeros(n,1);

A(1,1)= 1./2 + 3*D/(2*h);
A(1,n+2)= 5./8 + 6*D/(2*h);
A(1,2)= -4*D/(2*h);
A(1,n+3)= -8*D/(2*h);
A(1,3)= D/(2*h);
A(1,n+4)= 2*D/(2*h);

A(n+2,1)= -1./8;
A(n+2,n+2)= 5./8 + (3/(7*E3))*3/(2*h); 
A(n+2,n+3)= -(3/(7*E3))*4/(2*h);
A(n+2,n+4)= (3/(7*E3))*1/(2*h);
for i=2:n
    A(i,i-1)= -D/(h^2);
    A(i,i+n)= -2*D/(h^2);
    A(i,i)= Ea+2*D/(h^2);
    A(i,i+n+1)= 4*D/(h^2);
    A(i,i+1)= -D/(h^2);
    A(i,i+n+2)= -2*D/(h^2);
    B(i) = Q;
    
    A(i+n+1,i-1)= -2*D/(5*h^2); 
    A(i+n+1,i+n)= -(4/5+27*Et/(35*E3))*D/(h^2);
    A(i+n+1,i)= 4*D/(5*h^2);
    A(i+n+1,i+n+1)= E2+(2*D/(h^2))*(4/5+27*Et/(35*E3));
    A(i+n+1,i+1)= -2*D/(5*h^2);
    A(i+n+1,i+n+2)= -(4/5+27*Et/(35*E3))*D/(h^2);
end
A(n+1,n-1)= D/(2*h);
A(n+1,2*n)= 2*D/(2*h);
A(n+1,n)= -4*D/(2*h);
A(n+1,2*n+1)= -8*D/(2*h);
A(n+1,n+1)= 1./2 + 3*D/(2*h);
A(n+1,2*n+2)= 5./8 + 6*D/(2*h);

A(2*n+2,2*n)= (3/(7*E3))*1/(2*h);
A(2*n+2,2*n+1)= -(3/(7*E3))*4/(2*h);
A(2*n+2,n+1)= -1./8;
A(2*n+2,2*n+2)= 5./8 + (3/(7*E3))*3/(2*h); 

Z=A\B;

SF=1/2*(Z(2:n+1)+Z(1:n))
%SF=1/2*(Z(2:n+1)+Z(1:n)+Z(n+3:2*n+2)+Z(n+2:2*n+1));
%for i=1:length(SF)
%    SF(i)=1/2*(SF(i)+SF(end+1-i));
%    SF(end+1-i)=SF(i);
%end

p=0+h/2:h:T-h/2;                   % p is line along x-axis.
plot(p,SF,'r'); hold on

save SP3b.mat
